# This is a Spack Environment file.
#
# It describes a set of packages to be installed, along with
# configuration settings.
spack:
  definitions:
    - mpis: [mpich]
    - mpis: [openmpi]
      when: 'env.get("SPACK_STACK_USE_OPENMPI", "") == "1"'
    - lapacks: [ openblas, netlib-lapack ]
    - compilers: [ "gcc@12" ]
    - mpi_packages: [ netlib-scalapack ]
    - serial_packages: [py-scipy]

  specs:
  - gcc@12%gcc@11
  - matrix:
    - [$mpi_packages]
    - [$^mpis]
    - [$^lapacks]
    - [$%compilers]
  - matrix:
    - [$serial_packages]
    - [$^lapacks]
    - [$%compilers]
    exclude:
    - "py-scipy ^netlib-lapack"
  concretizer:
    unify: false
  view:
    default:
      root: views/default
      select: ['%gcc@12']
      exclude: [^mpich, ^netlib-lapack]
      link: roots
    full:
      root: views/full
      projections:
        ^mpi^lapack: '{name}/{name}-{version}-{^c.name}-{^c.version}-{^mpi.name}-{^mpi.version}-{^lapack.name}-{^lapack.version}'
        ^lapack: '{name}/{name}-{version}-{^c.name}-{^c.version}-{^lapack.name}-{^lapack.version}'
        '%c': '{name}/{name}-{version}-{^c.name}-{^c.version}'
        '%cxx': '{name}/{name}-{version}-{^cxx.name}-{^cxx.version}'
        '%fortran': '{name}/{name}-{version}-{^fortran.name}-{^fortran.version}'
        all: '{name}/{name}-{version}'
